{"version":3,"file":"angular-fire-storage.umd.js","sources":["../../../src/storage/observable/fromTask.ts","../../../src/storage/task.ts","../../../src/storage/ref.ts","../../../src/storage/storage.ts","../../../src/storage/pipes/storageUrl.pipe.ts","../../../src/storage/storage.module.ts"],"names":["Observable","debounceTime","map","of","observeOn","switchMap","from","InjectionToken","ɵAngularFireSchedulers","ɵkeepUnstableUntilFirstFactory","ɵfirebaseAppFactory","ɵfetchInstance","Injectable","Inject","FIREBASE_OPTIONS","Optional","FIREBASE_APP_NAME","PLATFORM_ID","NgZone","AsyncPipe","Pipe","ChangeDetectorRef","NgModule"],"mappings":";;;;;;;;;;;;;;;;;aAUgB,QAAQ,CAAC,IAAgB;AACxC,QAAC,OAAO,IAAIA,eAAU;AAAQ;AAC1B;AAAwB,WADe;AAAe;AAC1B;AAAwB,YADb,UAAU;AAAK;AAC9B,gBAAnB,QAAQ;AAAU;AAAgC;AAC9C,eADO,UAAC,IAAwB,IAAK,OAAA,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAA,CAAA;AACvE;AAA8B,gBAArB,KAAK;AAAU;AACf;AAA4B,eADpB;AAAe;AACf;AAA4B,gBAD5B,CAAC,IAAI,OAAA,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,GAAA,CAAA;AACzC;AAA8B,gBAArB,QAAQ;AAAU;AACtB,eADe,cAAM,OAAA,UAAU,CAAC,QAAQ,EAAE,GAAA,CAAA;AAC/C;AACS;AACS,YAAf,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC3B;AAA8B,gBAArB,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,eAAe,EAAE,QAAQ,CAAC;AACnD;AACS;AACS;AAEnB,YADI,IAAI,CAAC,IAAI;AAAQ;AAElB;AACU,eAHC;AACb;AACU;AAEJ,gBAJO,QAAQ;AAAK,gBACrB,QAAQ,CAAC,QAAQ,CAAC,CAAC;AACxB,gBAAK,QAAQ,EAAE,CAAC;AAChB,aAAI;AACJ;AAA6B;AAA4B,eADnD;AACC;AAA6B;AAA4B,gBAD1D,CAAC;AAAK;AAEH,gBAAJ,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAC7B,gBAAK,KAAK,CAAC,CAAC,CAAC,CAAC;AACd,aAAI,EAAC,CAAC;AACN;AACS,YAAN;AAAc;AACR,eADC,SAAS,WAAW;AAC9B,gBAAK,KAAK,EAAE,CAAC;AACb,aAAI,EAAC;AACL,SAAE,EAAC,CAAC,IAAI;AACR;AACK;AACK,QAAPC,sBAAY,CAAC,CAAC,CAAC,CAChB,CAAC;AACH,IAAD;AACC;AAAE;AAAS;AAAuC;AAAgC;AAA0J;AAAS;AAAS;AAAgB;AAAS,wCCvBvR;AAED;AACc;AAA0B,QAdtC,qCAAiB;AAClB;AAAa;AAAwB;AAAa,QAAjD,kEAA8D;AAC/D;AAAa;AAAwB;AAAa,QAAjD,oEAAoD;AACrD;AAAa;AACI;AACR,QAFR,wDAAiB;AAClB;AAAa;AACG;AAEhB,QAHC,yDAAkB;AACnB;AAAa;AAEL;AAAa,QAFpB,yDAAkB;AACnB;AACK;AAAoC;AACxB;AAAwB;AAC/B,QAHT,8EAGgB;AACjB;AAAa;AAAkC;AAIrC;AAAa,QAJtB,kEAAmD;AACpD;AAGA;AAAS;AACK;AACK;AAEC;AAAwB;AAAoB;AAAS,aAA1D,gBAAgB,CAAC,IAAgB;AAAK;AAClD,YAAI,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC;AAC9B,QAAC,OAAO;AACR,YAAG,IAAI,MAAA;AACP,YAAG,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;AAC7B,YAAG,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;AAC/B,YAAG,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC;AAC/B,YAAG,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;AACjC,YAAG,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;AACjC,YAAG,eAAe;AAAS;AACP,eADA,cAAM,OAAA,MAAM,GAAA,CAAA;AAChC,YAAG,iBAAiB;AAAS;AACd,eADO,cAAM,OAAA,MAAM,CAAC,IAAI,CAClCC,aAAG;AAAQ;AAA6B;AAIzC,eAJK;AAAe;AAA6B;AAIzC,gBAJH,CAAC,IAAI,OAAA,CAAC,CAAC,gBAAgB,GAAG,CAAC,CAAC,UAAU,GAAG,GAAG,GAAA,EAAC,CAClD,GAAA,CAAA;AACJ,SAAE,CAAC;AACH,IAAD;AACC;AAAE;AAAS;AAAuC;AAA+B;AAA0J;AAAS;AAAS;AAAgB;AAAS,8CCxBtR;AAED;AACc;AAAa;AAAwB;AACnD,QAZE,uEAAkC;AACnC;AAAa;AACV;AAAa,QADf,oEAA+B;AAChC;AAAa;AACL;AAAa,QADpB,+DAA0B;AAC3B;AAAa;AACA;AAAwB;AAAa,QADjD,kEAAyB;AAC1B;AAAa;AAA4B;AACnC;AAAa,QADlB,2EAAwD;AACzD;AAAa;AAA4B;AAAiC;AACxD;AAAa,QAD9B,0EAA6E;AAC9E;AAAa;AAA4B;AAA+B;AAAiC;AAC9F;AAAa,QADvB,wFAAmH;AACpH;AAAa;AACb;AAGM,QAJL,gEAAkC;AACnC;AAGA;AAAS;AACK;AAEC;AACX;AACY;AACI;AAAoB;AAAS,aAHlC,gBAAgB,CAC9B,GAAc,EACd,UAAkC,EAClC,sBAAiE;AAC/D,QACF,OAAO;AACR,YAAG,cAAc;AAAS;AAClB,eADW,cAAM,OAAAC,OAAE,CAAC,SAAS,CAAC,CAAC,IAAI,CACtCC,mBAAS,CAAC,UAAU,CAAC,cAAc,CAAC,EACpCC,mBAAS;AAAQ;AACjB,eADU,cAAM,OAAA,GAAG,CAAC,cAAc,EAAE,GAAA,EAAC,EACrC,sBAAsB,CACvB,GAAA,CAAA;AACJ,YAAG,WAAW;AAAS;AACf,eADQ,cAAM,OAAAF,OAAE,CAAC,SAAS,CAAC,CAAC,IAAI,CACnCC,mBAAS,CAAC,UAAU,CAAC,cAAc,CAAC,EACpCC,mBAAS;AAAQ;AACd,eADO,cAAM,OAAA,GAAG,CAAC,WAAW,EAAE,GAAA,EAAC,EAClC,sBAAsB,CACvB,GAAA,CAAA;AACJ,YAAG,MAAM;AAAS;AACV,eADG,cAAM,OAAAC,SAAI,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,GAAA,CAAA;AACnC,YAAG,KAAK;AAAS;AAAgC;AAA4B,eAAnE,UAAC,IAAY,IAAK,OAAA,gBAAgB,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,UAAU,EAAE,sBAAsB,CAAC,GAAA,CAAA;AACjG,YAAG,cAAc;AAAS;AAAgC;AACpD,eADa,UAAC,IAAsB,IAAK,OAAAA,SAAI,CAAC,GAAG,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,GAAA,CAAA;AAC7E,YAAG,GAAG;AAAS;AAAgC;AAChB;AAChB,eAFP,UAAC,IAAS,EAAE,QAAyB;AAAK;AACnB,oBAApB,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,QAAQ,CAAC;AACzC,gBAAK,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;AACnC,aAAI,CAAA;AACJ,YAAG,SAAS;AAAS;AAAgC;AAClD;AAAqC;AAC9B,eAFI,UAAC,IAAY,EAAE,MAAqB,EAAE,QAAyB;AAAK;AACnD,oBAApB,IAAI,GAAG,GAAG,CAAC,SAAS,CAAC,IAAI,EAAE,MAAM,EAAE,QAAQ,CAAC;AACvD,gBAAK,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;AACnC,aAAI,CAAA;AACJ,YAAG,OAAO;AAAS;AAGlB,eAHW,cAAM,OAAAA,SAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC,GAAA,CAAA;AACrC,SAAE,CAAC;AACH,IAAD;AACC;AAAE;AAAS;AAAuC;AAAmC;AAA0J;AAAS;AAAsB,QClClQ,MAAM,GAAG,IAAIC,iBAAc,CAAS,4BAA4B;AAC5E;AAAsB,QAAV,qBAAqB,GAAG,IAAIA,iBAAc,CAAS,yCAAyC;AACxG;AAAsB,QAAV,wBAAwB,GAAG,IAAIA,iBAAc,CAAS,4CAA4C;AAE/G;AACK;AAEE;AAAQ;AACK;AAGZ;AACI;AACX;AAEsB;AAAa;AAEvB;AAAoC;AAC/C;AAAkC;AAE3B;AAC2B;AACX;AAAa,QAFpC,4BAC4B,OAAwB,EACX,YAA2D,EACtE,aAA4B;AAC1D;AACK,QAAkB,UAAkB,EACvC,IAAY,EAC+B,kBAAgC,EAC7B,qBAAmC;AAClF,YACC,IAAI,CAAC,UAAU,GAAG,IAAIC,yBAAsB,CAAC,IAAI,CAAC,CAAC;AACtD,YAAG,IAAI,CAAC,sBAAsB,GAAGC,iCAA8B,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AACjF;AAA8B,gBAArB,GAAG,GAAGC,sBAAmB,CAAC,OAAO,EAAE,IAAI,EAAE,YAAY,CAAC;AAEhE,YAAI,IAAI,CAAC,OAAO,GAAGC,iBAAc,CAAI,GAAG,CAAC,IAAI,iBAAY,aAAe,EAAE,oBAAoB,EAAE,GAAG;AAAS;AACjF,eAD0E;AAC9F;AAAkC,oBAA7B,OAAO,GAAG,IAAI,CAAC,iBAAiB;AAAQ;AAAgC,mBAAvC,cAAM,OAAA,GAAG,CAAC,OAAO,CAAC,aAAa,IAAI,SAAS,CAAC,GAAA,EAAC;AAC1F,gBAAK,IAAI,kBAAkB,EAAE;AAC7B,oBAAO,OAAO,CAAC,qBAAqB,CAAC,kBAAkB,CAAC,CAAC;AACzD,iBAAM;AACN,gBAAK,IAAI,qBAAqB,EAAE;AAChC,oBAAO,OAAO,CAAC,wBAAwB,CAAC,qBAAqB,CAAC,CAAC;AAC/D,iBAAM;AACN,gBAAK,OAAO,OAAO,CAAC;AACpB,aAAI,GAAE,CAAC,kBAAkB,EAAE,qBAAqB,CAAC,CAAC,CAAC;AACnD,SAAE;AAEH;AAAa;AACM;AAAwB;AAAa,QADtD,gCAAG,GAAH,UAAI,IAAY;AACjB,YAAG,OAAO,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;AACjG,SAAE;AAEF;AAAa;AACD;AAAwB;AAAa,QADhD,uCAAU,GAAV,UAAW,IAAY;AACxB,YAAG,OAAO,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,sBAAsB,CAAC,CAAC;AACxG,SAAE;AAEF;AAAa;AAA4B;AACnC;AAAiC;AACvB;AAAa,QAF5B,mCAAM,GAAN,UAAO,IAAY,EAAE,IAAS,EAAE,QAAyB;AAC1D;AAA8B,gBAArB,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC;AAC5C;AAA8B,gBAArB,GAAG,GAAG,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,sBAAsB,CAAC;AACzF,YAAG,OAAO,GAAG,CAAC,GAAG,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;AAClC,SAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCACH;AACC;AACkC,SA/CzB;AAAE;+BAHXC,aAAU,SAAC,rDAIV;YAHA,UAAU,EAAE,KAAK,mBAClB,hDAIW,gDAIPC,SAAM,SAACC,mBAAgB;AAAU,gDACjCC,WAAQ,YAAIF,SAAM,SAACG,oBAAiB;AAAU,gDAC9CD,WAAQ,YAAIF,SAAM,SAAC,MAAM;AAAU,gBAEH,MAAM,uBAAtCA,SAAM,SAACI,cAAW;AAAU,gBA1CYC,SAAM;AAAK,gDA4CnDH,WAAQ,YAAIF,SAAM,SAAC,qBAAqB;AAAU,gDAClDE,WAAQ,YAAIF,SAAM,SAAC,wBAAwB;AAAS;AAAW;AAQhE;AAAkB;AACN,QAtBd,qCAAkD;AAEpD;AAA0B,QAAxB,oDAAiF;AAClF;AAA0B,QAAzB,wCAAmD;AAErD;AAAO;AAAE;AACN;AAAuC;AACP;AAEZ;AAAS;AAAS;AAEnC;AAAS;AACyC;AAAa;AAClD;AAA2B;AAAa,QC7BzD,4BAAoB,OAA2B,EAAE,GAAsB;AACxE,YADqB,YAAO,GAAP,OAAO,CAAoB;AAAE,YAC/C,IAAI,CAAC,SAAS,GAAG,IAAIM,gBAAS,CAAC,GAAG,CAAC,CAAC;AACvC,SAAE;AAEH;AAAa;AACA;AACN;AAAa,QAFlB,sCAAS,GAAT,UAAU,IAAY;AACvB,YAAG,IAAI,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE;AAC3B,gBAAK,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;AACtB,gBAAK,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,cAAc,EAAE,CAAC;AACjE,aAAI;AACJ,YAAG,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;AACtD,SAAE;AAEF;AAAa;AACM;AAAa,QAD/B,wCAAW,GAAX;AAAe,YACb,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;AAChC,SAAE;;;;;;;;;gHACH;AACC;AAGqB,SAzBZ;AAAE;+BAJXC,OAAI,SAAC,/CAI8B;MAHlC,IAAI,EAAE,gBAAgB,5BAKK,gBATpB,kBAAkB;YAKzB,IAAI,EAAE,KAAK,vBALmB,gBAFvBC,oBAAiB;GAQzB,HAR6B;AAAW;AAAkB;AAAa;AACvE;AAAqB;AACtB,QASE,uCAA6B;AAC9B;AAAa;AACF;AAAqB;AAE7B,QAHF,kCAAqB;AACtB;AAAa;AAAsB;AAErB;AAAa,QAF1B,0CAAsC;AAExC;AAAa;AAAsB;AAAqB;AAAa,QAAvD,qCAAmC;AAAE;AAAO;AAI1D,QAkBA;AAAuC;;;;;;;;;;gDAChC;AAAE;AAA0C,SADzC;AAAE;AAAE;AAAS;WAJtBC,WAAQ,SAAC,/BAKW;YAJnB,YAAY,EAAE,CAAE,kBAAkB,CAAE,uBACpC,OAAO,EAAE,CAAE,kBAAkB,CAAE,oBAChC,tHAE8D;AAA0J;AAAS;AAAiE,QC/BnS;AAAuC;;;;;;;;;;gDACjC;AAAE;AAA0C,SADxC;AAAE;AAAE;AAAS;WAJtBA,WAAQ,SAAC,/BAKU;gBAJlB,OAAO,EAAE,CAAE,wBAAwB,CAAE,uBACrC,SAAS,EAAE,CAAE,kBAAkB,CAAE,mBAClC,5HAEyD;AAA0J;AAAS;AAAE;AAAS;AAAuC;AAAgD;AAA0J;AAAS;AAAE;AAAsD;AAAkE;AAA8B;AAAsD;AAAkE;AAAkE;AAA4D;AAAkD;AAAkD;AAAkC;AAAE;AAAoE;AAAE;AAAO","sourcesContent":["import { Observable } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\nimport { UploadTask, UploadTaskSnapshot } from '../interfaces';\n\n// need to import, else the types become import('firebase/app').default.storage.UploadTask\n// and it no longer works w/Firebase v7\nimport firebase from 'firebase/app';\n\n// Things aren't working great, I'm having to put in a lot of work-arounds for what\n// appear to be Firebase JS SDK bugs https://github.com/firebase/firebase-js-sdk/issues/4158\nexport function fromTask(task: UploadTask) {\n  return new Observable<UploadTaskSnapshot>(subscriber => {\n    const progress = (snap: UploadTaskSnapshot) => subscriber.next(snap);\n    const error = e => subscriber.error(e);\n    const complete = () => subscriber.complete();\n    // emit the current snapshot, so they don't have to wait for state_changes\n    // to fire next... this is stale if the task is no longer running :(\n    progress(task.snapshot);\n    const unsub = task.on('state_changed', progress);\n    // it turns out that neither task snapshot nor 'state_changed' fire the last\n    // snapshot before completion, the one with status 'success\" and 100% progress\n    // so let's use the promise form of the task for that\n    task.then(snapshot => {\n      progress(snapshot);\n      complete();\n    }, e => {\n      // TODO investigate, again this is stale, we never fire a canceled or error it seems\n      progress(task.snapshot);\n      error(e);\n    });\n    // on's type if Function, rather than () => void, need to wrap\n    return function unsubscribe() {\n      unsub();\n    };\n  }).pipe(\n    // deal with sync emissions from first emitting `task.snapshot`, this makes sure\n    // that if the task is already finished we don't emit the old running state\n    debounceTime(0)\n  );\n}\n","import { UploadTask, UploadTaskSnapshot } from './interfaces';\nimport { fromTask } from './observable/fromTask';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport interface AngularFireUploadTask {\n  task: UploadTask;\n  snapshotChanges(): Observable<UploadTaskSnapshot | undefined>;\n  percentageChanges(): Observable<number | undefined>;\n  pause(): boolean;\n  cancel(): boolean;\n  resume(): boolean;\n  then(\n    onFulfilled?: ((a: UploadTaskSnapshot) => any) | null,\n    onRejected?: ((a: Error) => any) | null\n  ): Promise<any>;\n  catch(onRejected: (a: Error) => any): Promise<any>;\n}\n\n/**\n * Create an AngularFireUploadTask from a regular UploadTask from the Storage SDK.\n * This method creates an observable of the upload and returns on object that provides\n * multiple methods for controlling and monitoring the file upload.\n */\nexport function createUploadTask(task: UploadTask): AngularFireUploadTask {\n  const inner$ = fromTask(task);\n  return {\n    task,\n    then: task.then.bind(task),\n    catch: task.catch.bind(task),\n    pause: task.pause.bind(task),\n    cancel: task.cancel.bind(task),\n    resume: task.resume.bind(task),\n    snapshotChanges: () => inner$,\n    percentageChanges: () => inner$.pipe(\n      map(s => s.bytesTransferred / s.totalBytes * 100)\n    )\n  };\n}\n","import { ListResult, Reference, SettableMetadata, StringFormat, UploadMetadata } from './interfaces';\nimport { AngularFireUploadTask, createUploadTask } from './task';\nimport { from, Observable, of } from 'rxjs';\nimport { ɵAngularFireSchedulers } from '@angular/fire';\nimport { observeOn, switchMap } from 'rxjs/operators';\n\nexport interface AngularFireStorageReference {\n  getDownloadURL(): Observable<any>;\n  getMetadata(): Observable<any>;\n  delete(): Observable<any>;\n  child(path: string): any;\n  updateMetadata(meta: SettableMetadata): Observable<any>;\n  put(data: any, metadata?: UploadMetadata | undefined): AngularFireUploadTask;\n  putString(data: string, format?: string | undefined, metadata?: UploadMetadata | undefined): AngularFireUploadTask;\n  listAll(): Observable<ListResult>;\n}\n\n/**\n * Create an AngularFire wrapped Storage Reference. This object\n * creates observable methods from promise based methods.\n */\nexport function createStorageRef(\n  ref: Reference,\n  schedulers: ɵAngularFireSchedulers,\n  keepUnstableUntilFirst: <T>(obs$: Observable<T>) => Observable<T>\n): AngularFireStorageReference {\n  return {\n    getDownloadURL: () => of(undefined).pipe(\n      observeOn(schedulers.outsideAngular),\n      switchMap(() => ref.getDownloadURL()),\n      keepUnstableUntilFirst\n    ),\n    getMetadata: () => of(undefined).pipe(\n      observeOn(schedulers.outsideAngular),\n      switchMap(() => ref.getMetadata()),\n      keepUnstableUntilFirst\n    ),\n    delete: () => from(ref.delete()),\n    child: (path: string) => createStorageRef(ref.child(path), schedulers, keepUnstableUntilFirst),\n    updateMetadata: (meta: SettableMetadata) => from(ref.updateMetadata(meta)),\n    put: (data: any, metadata?: UploadMetadata) => {\n      const task = ref.put(data, metadata);\n      return createUploadTask(task);\n    },\n    putString: (data: string, format?: StringFormat, metadata?: UploadMetadata) => {\n      const task = ref.putString(data, format, metadata);\n      return createUploadTask(task);\n    },\n    listAll: () => from(ref.listAll())\n  };\n}\n","import { Inject, Injectable, InjectionToken, NgZone, Optional, PLATFORM_ID } from '@angular/core';\nimport { createStorageRef } from './ref';\nimport { Observable } from 'rxjs';\nimport {\n  FIREBASE_APP_NAME,\n  FIREBASE_OPTIONS,\n  FirebaseAppConfig,\n  FirebaseOptions,\n  ɵAngularFireSchedulers,\n  ɵfetchInstance,\n  ɵfirebaseAppFactory,\n  ɵkeepUnstableUntilFirstFactory\n} from '@angular/fire';\nimport { UploadMetadata } from './interfaces';\nimport 'firebase/storage';\nimport firebase from 'firebase/app';\n\nexport const BUCKET = new InjectionToken<string>('angularfire2.storageBucket');\nexport const MAX_UPLOAD_RETRY_TIME = new InjectionToken<number>('angularfire2.storage.maxUploadRetryTime');\nexport const MAX_OPERATION_RETRY_TIME = new InjectionToken<number>('angularfire2.storage.maxOperationRetryTime');\n\n/**\n * AngularFireStorage Service\n *\n * This service is the main entry point for this feature module. It provides\n * an API for uploading and downloading binary files from Cloud Storage for\n * Firebase.\n */\n@Injectable({\n  providedIn: 'any'\n})\nexport class AngularFireStorage {\n  public readonly storage: firebase.storage.Storage;\n\n  public readonly keepUnstableUntilFirst: <T>(obs: Observable<T>) => Observable<T>;\n  public readonly schedulers: ɵAngularFireSchedulers;\n\n  constructor(\n    @Inject(FIREBASE_OPTIONS) options: FirebaseOptions,\n    @Optional() @Inject(FIREBASE_APP_NAME) nameOrConfig: string | FirebaseAppConfig | null | undefined,\n    @Optional() @Inject(BUCKET) storageBucket: string | null,\n    // tslint:disable-next-line:ban-types\n    @Inject(PLATFORM_ID) platformId: Object,\n    zone: NgZone,\n    @Optional() @Inject(MAX_UPLOAD_RETRY_TIME) maxUploadRetryTime: number | any,\n    @Optional() @Inject(MAX_OPERATION_RETRY_TIME) maxOperationRetryTime: number | any,\n  ) {\n    this.schedulers = new ɵAngularFireSchedulers(zone);\n    this.keepUnstableUntilFirst = ɵkeepUnstableUntilFirstFactory(this.schedulers);\n    const app = ɵfirebaseAppFactory(options, zone, nameOrConfig);\n\n    this.storage = ɵfetchInstance(`${app.name}.storage.${storageBucket}`, 'AngularFireStorage', app, () => {\n      const storage = zone.runOutsideAngular(() => app.storage(storageBucket || undefined));\n      if (maxUploadRetryTime) {\n        storage.setMaxUploadRetryTime(maxUploadRetryTime);\n      }\n      if (maxOperationRetryTime) {\n        storage.setMaxOperationRetryTime(maxOperationRetryTime);\n      }\n      return storage;\n    }, [maxUploadRetryTime, maxOperationRetryTime]);\n  }\n\n  ref(path: string) {\n    return createStorageRef(this.storage.ref(path), this.schedulers, this.keepUnstableUntilFirst);\n  }\n\n  refFromURL(path: string) {\n    return createStorageRef(this.storage.refFromURL(path), this.schedulers, this.keepUnstableUntilFirst);\n  }\n\n  upload(path: string, data: any, metadata?: UploadMetadata) {\n    const storageRef = this.storage.ref(path);\n    const ref = createStorageRef(storageRef, this.schedulers, this.keepUnstableUntilFirst);\n    return ref.put(data, metadata);\n  }\n\n}\n","import { AsyncPipe } from '@angular/common';\nimport { ChangeDetectorRef, NgModule, OnDestroy, Pipe, PipeTransform } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { AngularFireStorage } from '../storage';\n\n/** to be used with in combination with | async */\n@Pipe({\n  name: 'getDownloadURL',\n  pure: false,\n})\nexport class GetDownloadURLPipe implements PipeTransform, OnDestroy {\n\n  private asyncPipe: AsyncPipe;\n  private path: string;\n  private downloadUrl$: Observable<any>;\n\n  constructor(private storage: AngularFireStorage, cdr: ChangeDetectorRef) {\n    this.asyncPipe = new AsyncPipe(cdr);\n  }\n\n  transform(path: string) {\n    if (path !== this.path) {\n      this.path = path;\n      this.downloadUrl$ = this.storage.ref(path).getDownloadURL();\n    }\n    return this.asyncPipe.transform(this.downloadUrl$);\n  }\n\n  ngOnDestroy() {\n    this.asyncPipe.ngOnDestroy();\n  }\n\n}\n\n@NgModule({\n  declarations: [ GetDownloadURLPipe ],\n  exports: [ GetDownloadURLPipe ],\n})\nexport class GetDownloadURLPipeModule {}\n","import { NgModule } from '@angular/core';\nimport { GetDownloadURLPipeModule } from './pipes/storageUrl.pipe';\nimport { AngularFireStorage } from './storage';\n\n@NgModule({\n  exports: [ GetDownloadURLPipeModule ],\n  providers: [ AngularFireStorage ]\n})\nexport class AngularFireStorageModule { }\n"]}